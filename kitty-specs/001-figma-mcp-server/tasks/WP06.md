---
work_package_id: "WP06"
title: "Target Node Resolution"
lane: "planned"
dependencies: ["WP03"]
---

# WP06: Target Node Resolution

## Objective
Determine which Figma node a comment refers to based on its position.

## Context
When a designer pins a comment to the canvas, Figma stores position metadata. We need to resolve this to the actual node the comment is referring to.

## Tasks

1. **Implement `resolve_target_from_comment` command**
   - Plugin-side command executor
   - Input: `{ frame_node_id?, client_meta, x?, y?, thread_id }`
   - Output: `{ target_node_id, confidence, reason, boundsSnapshot }`

2. **Hit-testing logic**
   - Use frame + offset to find nodes at position
   - Handle overlapping nodes (pick topmost)
   - Return confidence score (high if direct hit, lower if inferred)

3. **Optional UX feedback**
   - `flash_node` - Briefly highlight the resolved node
   - `focus_viewport_on_node` - Pan viewport to show node
   - Helps designers see "Claude is working _here_"

## Deliverables

- [ ] `figma-plugin-bridge/src/commands/comments.ts`
- [ ] Add types to `figma-mcp-server/src/commands/schema.ts`
- [ ] Unit tests for hit-testing

## Acceptance Criteria

- Comments pinned directly on nodes resolve correctly
- Confidence score reflects accuracy
- Flash/focus commands work in Figma
