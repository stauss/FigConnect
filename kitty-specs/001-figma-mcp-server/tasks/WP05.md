---
work_package_id: "WP05"
title: "Safety Gating"
lane: "planned"
dependencies: ["WP03", "WP04"]
---

# WP05: Safety Gating

## Objective
Require explicit confirmation before executing destructive operations.

## Context
Destructive actions (delete, bulk updates, style changes) should not execute automatically. The AI should present a plan and wait for confirmation.

## Tasks

1. **Define destructive actions**
   - `delete_node` - Single or multiple
   - Bulk operations (>5 nodes)
   - Style changes affecting multiple nodes
   - Any operation with `isDestructive: true`

2. **Implement Plan → Confirm → Execute flow**
   - AI posts plan as reply: "I'll delete these 3 items: [list]. Reply `Claude: go` to confirm."
   - Wait for confirmation in same thread
   - Execute only after `Claude: go` received

3. **Add confirmation timeout**
   - Default: 5 minutes
   - After timeout: mark task as `canceled`
   - Post reply: "Operation canceled (timed out)"

4. **Log confirmation events**
   - Who confirmed
   - Time to confirmation
   - What was executed

## Deliverables

- [ ] `figma-mcp-server/src/comments/safety.ts`
- [ ] Confirmation tracking in task queue
- [ ] Unit tests for safety flow

## Acceptance Criteria

- Destructive ops require `Claude: go` confirmation
- Non-destructive ops execute immediately
- Timeout correctly cancels pending operations
- All confirmation events logged
