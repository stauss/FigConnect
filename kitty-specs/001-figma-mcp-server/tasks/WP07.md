---
work_package_id: "WP07"
title: "Comment Task Router"
lane: "planned"
dependencies: ["WP05", "WP06"]
---

# WP07: Comment Task Router

## Objective
Connect all pieces into the complete end-to-end comment-to-action flow.

## Tasks

1. **Implement comment task router**
   - Orchestrates the full flow
   - Handles errors at each step
   - Posts appropriate status updates

2. **Execution flow**
   1. Parse comment task (WP03)
   2. Resolve target node via plugin (WP06)
   3. Gather context (node details, nearby nodes, styles)
   4. Decide actions (AI decision making)
   5. Check safety gating (WP05)
   6. Execute commands (existing bridge)
   7. Reply in thread with summary

3. **Add task templates for common ops**
   - "move X by N px" → `move_node`
   - "duplicate" → `duplicate_node`
   - "delete" → `delete_node` (with safety)
   - "rename" → `set_properties`
   - "apply style" → `apply_style`
   - "fix padding" → `set_properties` + auto-layout

## Deliverables

- [ ] `figma-mcp-server/src/comments/router.ts`
- [ ] Task template definitions
- [ ] Integration tests for full flow

## Acceptance Criteria

- Full flow executes without manual intervention
- Appropriate status replies at each stage
- Task templates work for common operations
- Errors handled gracefully with helpful messages
